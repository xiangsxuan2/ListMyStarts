name: .NET Core Console App

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  build-and-run:
    runs-on: windows-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 8.0.x

    - name: Build and run
      run: |
        # 构建项目
        dotnet build ListMyStarts/ListMyStarts.csproj --configuration Release
        
        # 运行程序
        cd ListMyStarts
        dotnet run --configuration Release --no-build
        
        # 检查文件是否生成
        if (Test-Path "../My Starts.md") {
          echo "File generated successfully"
        } else {
          echo "File not found"
          # 查看当前目录结构
          dir ../
        }
      
    - name: Commit and push
      run: |
        git config --local user.email "xiangshouxuan@foxmail.com"
        git config --local user.name "xiangsxuan"
        git pull origin main
        
        # 检查是否有文件需要提交
        if git status --porcelain | grep -q "M"; then
          git add .
          git commit -m ":sparkles: Add generated repo.md file"
          git push origin main
          echo "Changes pushed successfully"
        else
          echo "No changes to commit"
        fi